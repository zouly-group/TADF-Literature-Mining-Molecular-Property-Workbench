# Flask Web应用使用指南

## 概述

本应用提供了一个基于Flask + HTML/CSS/JS的现代化Web界面，用于TADF数据抽取和人工辅助的SMILES识别。

## 功能特性

### 1. 简洁现代的UI设计
- 简约的配色方案（蓝色主题）
- 响应式布局，支持各种屏幕尺寸
- 流畅的交互动画

### 2. PDF上传与处理
- 拖拽上传PDF文件
- 实时进度显示
- 后台异步处理，不阻塞界面

### 3. 数据持久化
- 所有数据自动保存到JSON文件
- 刷新页面后数据仍然存在
- 支持多篇论文管理

### 4. 数据查看与编辑
- 表格形式展示数据
- 在线编辑（特别是SMILES字段）
- 支持导出JSON格式

### 5. 分子结构图展示
- 按页面分组显示
- 点击查看大图
- 方便截图使用

### 6. SMILES识别助手
- **支持图片粘贴**：使用Ctrl+V / Cmd+V直接粘贴剪贴板中的图片
- **支持图片上传**：点击按钮选择图片文件
- **支持拖拽上传**：直接拖拽图片到粘贴区域
- **一键填充**：将识别结果直接填充到对应的数据记录

### 7. 弹窗设计
- 所有操作通过弹窗完成，界面简洁
- 支持标签页切换，功能分类清晰

## 安装与启动

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

确保已安装以下关键依赖：
- `flask>=2.3.0`
- `flask-cors>=4.0.0`
- `pillow>=9.0.0`
- `requests>=2.28.0`

### 2. 启动DECIMER服务

在启动Web应用之前，需要先启动DECIMER服务：

```bash
# 方式1: 使用启动脚本
bash start_decimer_server.sh

# 方式2: 直接运行
python server.py
```

DECIMER服务将在 `http://localhost:8000` 运行。

### 3. 启动Web应用

```bash
# 方式1: 使用启动脚本
bash start_web_app.sh

# 方式2: 直接运行
python web_app.py
```

应用将在 `http://localhost:5000` 运行，在浏览器中访问该地址。

## 使用流程

### 步骤1: 上传PDF

1. 在"上传PDF"页面
2. 输入论文ID（或使用默认值）
3. 点击选择PDF文件，或直接拖拽文件到上传区域
4. 点击"开始处理"按钮

处理过程包括：
- MinerU PDF解析（可能需要几分钟）
- 文档结构解析
- 图像分类（识别分子结构图）
- 数据抽取（光物性、器件数据）

**实时进度显示**：
- 进度条实时更新
- 显示当前处理步骤
- 处理完成后自动跳转到论文列表

### 步骤2: 查看论文列表

1. 点击"论文列表"查看所有已处理的论文
2. 显示每篇论文的统计信息：
   - 光物性数据条数
   - 器件数据条数
   - 分子结构图数量
   - 创建时间
3. 点击论文项打开详情弹窗

### 步骤3: 编辑数据

1. 在论文详情弹窗中，切换到"数据编辑"标签页
2. 选择数据类型（光物性数据/器件数据）
3. 在表格中直接编辑数据
4. 点击"保存"按钮保存更改
5. 点击"导出JSON"下载数据

**数据持久化**：
- 所有修改自动保存到JSON文件
- 刷新页面后数据仍然存在
- 支持多篇论文同时管理

### 步骤4: 查看分子结构图

1. 在论文详情弹窗中，切换到"分子结构图"标签页
2. 查看所有识别到的分子结构图
3. 点击图片查看大图
4. 使用系统截图工具截图（Windows: Win+Shift+S, Mac: Cmd+Shift+4）

### 步骤5: 使用SMILES识别助手

#### 方法1: 粘贴图片（推荐）

1. 在论文详情弹窗中，切换到"SMILES识别"标签页
2. 使用截图工具截图分子结构
3. 按 **Ctrl+V** (Windows) 或 **Cmd+V** (Mac) 粘贴图片
4. 图片会自动显示在粘贴区域
5. 点击"识别SMILES"按钮
6. 查看识别结果
7. 选择要填充的化合物，点击"填充到数据"

#### 方法2: 上传图片

1. 点击"选择图片"按钮
2. 选择包含分子结构的图片文件
3. 点击"识别SMILES"按钮
4. 查看并填充结果

#### 方法3: 拖拽上传

1. 将图片文件直接拖拽到粘贴区域
2. 图片会自动加载
3. 点击"识别SMILES"按钮

## 界面说明

### 导航栏
- **上传PDF**：切换到上传页面
- **论文列表**：查看所有已处理的论文

### 上传页面
- 论文ID输入框
- 文件上传区域（支持拖拽）
- 实时进度显示

### 论文列表页面
- 论文卡片列表
- 每张卡片显示统计信息
- 点击卡片打开详情

### 论文详情弹窗

#### 数据编辑标签页
- 数据类型切换按钮
- 可编辑数据表格
- 保存和导出按钮

#### 分子结构图标签页
- 图片网格展示
- 点击查看大图

#### SMILES识别标签页
- 图片粘贴/上传区域
- 识别结果展示
- 一键填充功能

## 技术特性

### 1. 数据持久化
- 使用JSON文件存储每篇论文的数据
- 存储位置：`data/processed/web_data/`
- 文件命名：`{paper_id}.json`

### 2. 实时进度
- 使用轮询机制（每秒更新一次）
- 显示处理进度百分比
- 显示当前处理步骤

### 3. 图片粘贴
- 使用浏览器剪贴板API
- 支持Ctrl+V / Cmd+V快捷键
- 自动检测图片格式

### 4. 响应式设计
- 支持桌面和移动设备
- 自适应布局
- 触摸友好的交互

## 注意事项

1. **DECIMER服务**：确保DECIMER服务正在运行，否则SMILES识别功能无法使用

2. **处理时间**：PDF处理可能需要几分钟时间，请耐心等待

3. **图片格式**：支持的图片格式：PNG、JPG、JPEG

4. **数据保存**：数据自动保存，刷新页面不会丢失

5. **网络连接**：需要网络连接以调用MinerU API和Qwen API

6. **API配置**：确保 `config.py` 中的API密钥配置正确

7. **浏览器兼容性**：推荐使用Chrome、Firefox、Edge等现代浏览器

## 故障排除

### 问题1: DECIMER服务连接失败

**解决方案**：
- 检查DECIMER服务是否运行：`curl http://localhost:8000/health`
- 确认端口8000未被占用
- 检查 `config.py` 中的 `DECIMER_API_URL` 配置

### 问题2: PDF处理失败

**解决方案**：
- 检查MinerU API配置（`MINERU_API_TOKEN`）
- 确认PDF文件格式正确
- 查看浏览器控制台和终端日志

### 问题3: 图片识别失败

**解决方案**：
- 确认图片格式正确（PNG/JPG）
- 检查图片是否包含清晰的分子结构
- 查看DECIMER服务日志

### 问题4: 图片粘贴不工作

**解决方案**：
- 确保在"SMILES识别"标签页中
- 使用现代浏览器（Chrome、Firefox、Edge）
- 检查浏览器权限设置

### 问题5: 数据丢失

**解决方案**：
- 检查 `data/processed/web_data/` 目录
- 确认JSON文件存在
- 查看浏览器控制台错误信息

## 技术架构

- **后端框架**: Flask
- **前端**: HTML5 + CSS3 + JavaScript (原生)
- **PDF处理**: MinerU API
- **图像分类**: Qwen-VL API
- **SMILES识别**: DECIMER (本地服务)
- **数据抽取**: Qwen LLM API
- **数据存储**: JSON文件

## 开发与扩展

### 添加新功能

1. 在 `web_app.py` 中添加新的API路由
2. 在 `static/js/app.js` 中添加前端逻辑
3. 在 `templates/index.html` 中添加UI元素
4. 在 `static/css/style.css` 中添加样式

### 自定义样式

修改 `static/css/style.css` 中的CSS变量：

```css
:root {
    --primary-color: #2563eb;  /* 主色调 */
    --bg-color: #f9fafb;        /* 背景色 */
    /* ... */
}
```

### 数据存储位置

- 上传的PDF：`data/processed/uploads/`
- 论文数据：`data/processed/web_data/`
- MinerU输出：`data/mineru_output/`

## 与Streamlit版本的区别

1. **更灵活的UI**：完全自定义的HTML/CSS，不受Streamlit限制
2. **更好的性能**：原生JavaScript，响应更快
3. **数据持久化**：自动保存到文件，刷新不丢失
4. **图片粘贴**：原生支持剪贴板API
5. **实时进度**：轮询机制，实时更新
6. **弹窗设计**：所有操作通过弹窗完成，界面更简洁

---

**祝您使用愉快！** 🎉

