# Streamlit Web应用使用指南

## 概述

本应用提供了一个基于Web的交互式界面，用于TADF数据抽取和人工辅助的SMILES识别。

## 功能特性

### 1. PDF上传与处理
- 上传PDF论文文件
- 自动使用MinerU进行PDF解析
- 自动识别和分类图像（特别是分子结构图）
- 自动抽取光物性数据和器件数据

### 2. 数据查看与编辑
- 以表格形式展示抽取的数据
- 支持在线编辑数据（特别是SMILES字段）
- 支持导出JSON格式数据

### 3. SMILES识别助手
- **显示论文中的分子结构图**：方便用户截图使用
- **上传图片识别**：上传分子结构图片，使用DECIMER识别SMILES
- **粘贴图片识别**：通过文件上传方式粘贴图片进行识别
- **一键填充**：将识别结果直接填充到对应的数据记录中

## 安装与启动

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

确保已安装以下关键依赖：
- `streamlit>=1.28.0`
- `pillow>=9.0.0`
- `pandas>=1.5.0`

### 2. 启动DECIMER服务

在启动Web应用之前，需要先启动DECIMER服务：

```bash
# 方式1: 使用启动脚本
bash start_decimer_server.sh

# 方式2: 直接运行
python server.py
```

DECIMER服务将在 `http://localhost:8000` 运行。

### 3. 启动Web应用

```bash
# 方式1: 使用启动脚本
bash start_app.sh

# 方式2: 直接运行
streamlit run app.py
```

应用将在 `http://localhost:8501` 运行，浏览器会自动打开。

## 使用流程

### 步骤1: 上传PDF

1. 在"PDF上传与处理"页面
2. 点击"上传PDF文件"，选择论文PDF
3. 输入论文ID（默认使用文件名）
4. 点击"开始处理"按钮

处理过程包括：
- MinerU PDF解析（可能需要几分钟）
- 文档结构解析
- 图像分类（识别分子结构图）
- 数据抽取（光物性、器件数据）

### 步骤2: 查看和编辑数据

1. 切换到"数据查看与编辑"页面
2. 选择数据类型（光物性数据或器件数据）
3. 在表格中直接编辑数据
4. 点击"保存修改"保存更改
5. 点击"导出JSON"下载数据

### 步骤3: 使用SMILES识别助手

#### 方法1: 从论文图片中截图

1. 在"SMILES识别助手"页面
2. 查看"论文中的分子结构图"部分
3. 使用系统截图工具截图（Windows: Win+Shift+S, Mac: Cmd+Shift+4）
4. 保存截图为图片文件
5. 在"上传图片"或"粘贴图片"区域上传截图
6. 点击"识别SMILES"按钮
7. 查看识别结果
8. 选择要填充的化合物，点击"填充SMILES"

#### 方法2: 上传外部图片

1. 准备分子结构图片（PNG/JPG格式）
2. 在"上传图片"区域上传
3. 点击"识别SMILES"按钮
4. 查看并填充结果

## 界面说明

### 侧边栏
- **功能导航**：切换不同功能页面
- **提示信息**：使用说明和注意事项

### 主页面

#### PDF上传与处理
- 文件上传区域
- 处理进度显示
- 统计信息（分子结构图数量、数据条数等）
- 分子结构图预览

#### 数据查看与编辑
- 数据类型选择（光物性/器件）
- 可编辑数据表格
- 保存和导出功能

#### SMILES识别助手
- 论文中的分子结构图展示（按页面分组）
- 图片上传/粘贴区域
- 识别结果显示
- 一键填充功能

## 注意事项

1. **DECIMER服务**：确保DECIMER服务正在运行，否则SMILES识别功能无法使用

2. **处理时间**：PDF处理可能需要几分钟时间，请耐心等待

3. **图片格式**：支持的图片格式：PNG、JPG、JPEG

4. **数据保存**：编辑的数据保存在session state中，刷新页面会丢失。建议及时导出JSON文件

5. **网络连接**：需要网络连接以调用MinerU API和Qwen API

6. **API配置**：确保 `config.py` 中的API密钥配置正确

## 故障排除

### 问题1: DECIMER服务连接失败

**解决方案**：
- 检查DECIMER服务是否运行：`curl http://localhost:8000/health`
- 确认端口8000未被占用
- 检查 `config.py` 中的 `DECIMER_API_URL` 配置

### 问题2: PDF处理失败

**解决方案**：
- 检查MinerU API配置（`MINERU_API_TOKEN`）
- 确认PDF文件格式正确
- 查看浏览器控制台和终端日志

### 问题3: 图片识别失败

**解决方案**：
- 确认图片格式正确（PNG/JPG）
- 检查图片是否包含清晰的分子结构
- 查看DECIMER服务日志

### 问题4: 数据编辑后丢失

**解决方案**：
- 及时点击"保存修改"按钮
- 定期导出JSON文件备份

## 技术架构

- **前端框架**: Streamlit
- **PDF处理**: MinerU API
- **图像分类**: Qwen-VL API
- **SMILES识别**: DECIMER (本地服务)
- **数据抽取**: Qwen LLM API

## 开发与扩展

### 添加新功能

1. 在 `app.py` 中添加新的页面或功能
2. 更新侧边栏导航
3. 添加相应的处理逻辑

### 自定义样式

Streamlit支持自定义CSS，可以在应用顶部添加：

```python
st.markdown("""
<style>
    /* 自定义样式 */
</style>
""", unsafe_allow_html=True)
```

## 联系与支持

如有问题或建议，请查看项目README或提交Issue。

---

**祝您使用愉快！** 🎉

