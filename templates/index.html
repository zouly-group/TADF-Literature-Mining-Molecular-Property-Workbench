<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TADFÊï∞ÊçÆÊäΩÂèñÁ≥ªÁªü</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">üî¨ TADFÊï∞ÊçÆÊäΩÂèñÁ≥ªÁªü</h1>
            <div class="nav-links">
                <button class="btn btn-link" onclick="showPage('upload')">‰∏ä‰º†PDF</button>
                <button class="btn btn-link" onclick="showPage('papers')">ËÆ∫ÊñáÂàóË°®</button>
                <button class="btn btn-link" onclick="showPage('database')">Êï∞ÊçÆÂ∫ìÊü•Áúã</button>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªÂÆπÂô® -->
    <div class="container main-container">
        <!-- ‰∏ä‰º†È°µÈù¢ -->
        <div id="upload-page" class="page active">
            <div class="card">
                <h2>‰∏ä‰º†PDFÊñá‰ª∂</h2>
                <form id="upload-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="paper-id">ËÆ∫ÊñáID</label>
                        <input type="text" id="paper-id" name="paper_id" placeholder="ËæìÂÖ•ËÆ∫ÊñáID" required>
                    </div>
                    <div class="form-group">
                        <label for="extraction-config">ÊäΩÂèñÈÖçÁΩÆÔºàÂèØÈÄâÔºâ</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <select id="extraction-config" name="extraction_config" style="flex: 1;">
                                <option value="">‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ</option>
                            </select>
                            <button type="button" class="btn btn-sm" onclick="showConfigModal()">ÁÆ°ÁêÜÈÖçÁΩÆ</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="pdf-file">ÈÄâÊã©PDFÊñá‰ª∂</label>
                        <div class="file-upload-area" id="file-upload-area">
                            <input type="file" id="pdf-file" name="file" accept=".pdf" required>
                            <div class="file-upload-placeholder">
                                <span class="upload-icon">üìÑ</span>
                                <p>ÁÇπÂáªÈÄâÊã©ÊàñÊãñÊãΩPDFÊñá‰ª∂Âà∞Ê≠§Â§Ñ</p>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂºÄÂßãÂ§ÑÁêÜ</button>
                </form>
            </div>

            <!-- ËøõÂ∫¶ÊòæÁ§∫ -->
            <div id="progress-container" class="card hidden">
                <h3>Â§ÑÁêÜËøõÂ∫¶</h3>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="progress-message" class="progress-message">ÂáÜÂ§á‰∏≠...</p>
            </div>
        </div>

        <!-- ËÆ∫ÊñáÂàóË°®È°µÈù¢ -->
        <div id="papers-page" class="page">
            <div class="card">
                <div class="card-header">
                    <h2>ËÆ∫ÊñáÂàóË°®</h2>
                    <button class="btn btn-primary" onclick="showPage('upload')">+ ‰∏ä‰º†Êñ∞ËÆ∫Êñá</button>
                </div>
                <div id="papers-list" class="papers-list">
                    <p class="loading">Âä†ËΩΩ‰∏≠...</p>
                </div>
            </div>
        </div>

        <!-- Êï∞ÊçÆÂ∫ìÊü•ÁúãÈ°µÈù¢ -->
        <div id="database-page" class="page">
            <div class="card">
                <div class="card-header">
                    <h2>Êï∞ÊçÆÂ∫ìÊü•Áúã</h2>
                </div>
                <div class="database-viewer">
                    <div class="table-selector">
                        <label for="table-select">ÈÄâÊã©Ë°®Ôºö</label>
                        <select id="table-select" onchange="loadTableData()">
                            <option value="">ËØ∑ÈÄâÊã©Ë°®</option>
                        </select>
                        <button class="btn btn-sm" onclick="refreshTables()">Âà∑Êñ∞</button>
                    </div>
                    
                    <div class="table-controls">
                        <div class="search-box">
                            <input type="text" id="table-search" placeholder="ÊêúÁ¥¢..." onkeyup="handleTableSearch(event)">
                            <button class="btn btn-sm" onclick="loadTableData()">ÊêúÁ¥¢</button>
                        </div>
                        <div class="pagination-info" id="pagination-info"></div>
                    </div>
                    
                    <div id="table-data-container" class="table-data-container">
                        <p class="loading">ËØ∑ÈÄâÊã©‰∏Ä‰∏™Ë°®</p>
                    </div>
                    
                    <div class="pagination-controls" id="pagination-controls"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ËÆ∫ÊñáËØ¶ÊÉÖÂºπÁ™ó -->
    <div id="paper-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ËÆ∫ÊñáËØ¶ÊÉÖ</h2>
                <div class="modal-header-controls">
                    <button class="modal-btn" onclick="zoomModalOut('paper-modal')" title="Áº©Â∞è">‚àí</button>
                    <span id="modal-zoom-level" class="modal-zoom-level">100%</span>
                    <button class="modal-btn" onclick="zoomModalIn('paper-modal')" title="ÊîæÂ§ß">+</button>
                    <button class="modal-btn" onclick="resetModalZoom('paper-modal')" title="ÈáçÁΩÆ">ÈáçÁΩÆ</button>
                    <button class="modal-btn" onclick="toggleModalFullscreen('paper-modal')" title="ÂÖ®Â±è" id="fullscreen-btn">‚õ∂</button>
                    <button class="modal-close" onclick="closeModal('paper-modal')">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('data-tab')">Êï∞ÊçÆÁºñËæë</button>
                    <button class="tab-btn" onclick="showTab('figures-tab')">ÂàÜÂ≠êÁªìÊûÑÂõæ</button>
                    <button class="tab-btn" onclick="showTab('smiles-tab')">SMILESËØÜÂà´</button>
                    <button class="tab-btn" onclick="showTab('source-tab')">ÂéüÊñáÊü•Áúã</button>
                </div>

                <!-- Êï∞ÊçÆÁºñËæëÊ†áÁ≠æÈ°µ -->
                <div id="data-tab" class="tab-content active">
                    <div class="tab-controls">
                        <button class="btn btn-sm" onclick="switchDataType('photophysical')">ÂÖâÁâ©ÊÄßÊï∞ÊçÆ</button>
                        <button class="btn btn-sm" onclick="switchDataType('device')">Âô®‰ª∂Êï∞ÊçÆ</button>
                        <button class="btn btn-sm btn-success" onclick="saveData()">‰øùÂ≠ò</button>
                        <button class="btn btn-sm" onclick="exportData()">ÂØºÂá∫JSON</button>
                    </div>
                    <div id="data-table-container" class="table-container">
                        <table id="data-table" class="data-table">
                            <thead id="data-table-head"></thead>
                            <tbody id="data-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ÂàÜÂ≠êÁªìÊûÑÂõæÊ†áÁ≠æÈ°µ -->
                <div id="figures-tab" class="tab-content">
                    <div id="figures-container" class="figures-grid">
                        <p class="loading">Âä†ËΩΩ‰∏≠...</p>
                    </div>
                </div>

                <!-- SMILESËØÜÂà´Ê†áÁ≠æÈ°µ -->
                <div id="smiles-tab" class="tab-content">
                    <div class="smiles-recognizer">
                        <div class="paste-area" id="paste-area">
                            <div class="paste-placeholder">
                                <span class="paste-icon">üìã</span>
                                <p>Á≤òË¥¥ÂõæÁâá (Ctrl+V / Cmd+V)</p>
                                <p class="hint">ÊàñÁÇπÂáª‰∏ãÊñπÊåâÈíÆ‰∏ä‰º†ÂõæÁâá</p>
                            </div>
                            <canvas id="paste-canvas" class="hidden"></canvas>
                            <img id="paste-preview" class="hidden" alt="È¢ÑËßà">
                        </div>
                        <div class="upload-controls">
                            <input type="file" id="image-upload" accept="image/*" class="hidden">
                            <button class="btn btn-primary" onclick="document.getElementById('image-upload').click()">ÈÄâÊã©ÂõæÁâá</button>
                            <button class="btn btn-success" id="recognize-btn" onclick="recognizeImage()" disabled>ËØÜÂà´SMILES</button>
                        </div>
                        <div id="recognition-result" class="recognition-result hidden">
                            <div class="result-box">
                                <label>SMILESÁºñÁ†Å</label>
                                <textarea id="smiles-result" readonly></textarea>
                                <div class="result-meta">
                                    <span>ÁΩÆ‰ø°Â∫¶: <span id="confidence-value">-</span></span>
                                </div>
                            </div>
                            <div class="fill-controls">
                                <select id="compound-select"></select>
                                <button class="btn btn-primary" onclick="fillSmiles()">Â°´ÂÖÖÂà∞Êï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂéüÊñáÊü•ÁúãÊ†áÁ≠æÈ°µ -->
                <div id="source-tab" class="tab-content">
                    <div class="source-viewer">
                        <div class="source-layout">
                            <div class="source-left">
                                <h3>ÊäΩÂèñÁöÑÊï∞ÊçÆ</h3>
                                <div class="data-list-container">
                                    <div class="data-type-tabs">
                                        <button class="data-type-btn active" onclick="switchSourceDataType('photophysical')">ÂÖâÁâ©ÊÄßÊï∞ÊçÆ</button>
                                        <button class="data-type-btn" onclick="switchSourceDataType('device')">Âô®‰ª∂Êï∞ÊçÆ</button>
                                    </div>
                                    <div id="source-data-table-container" class="source-data-table-container">
                                        <p class="loading">ËØ∑ÈÄâÊã©Êï∞ÊçÆÁ±ªÂûã</p>
                                    </div>
                                </div>
                            </div>
                            <div class="source-right">
                                <div class="pdf-viewer-header">
                                    <h3>ËÆ∫ÊñáÂéüÊñá</h3>
                                    <div class="pdf-controls">
                                        <button class="btn btn-sm" onclick="zoomOut()" title="Áº©Â∞è">‚àí</button>
                                        <span id="zoom-level" class="zoom-level">100%</span>
                                        <button class="btn btn-sm" onclick="zoomIn()" title="ÊîæÂ§ß">+</button>
                                        <button class="btn btn-sm" onclick="resetZoom()" title="ÈáçÁΩÆ">ÈáçÁΩÆ</button>
                                        <button class="btn btn-sm" onclick="fitWidth()" title="ÈÄÇÂ∫îÂÆΩÂ∫¶">ÈÄÇÂ∫îÂÆΩÂ∫¶</button>
                                        <button class="btn btn-sm" onclick="fitPage()" title="ÈÄÇÂ∫îÈ°µÈù¢">ÈÄÇÂ∫îÈ°µÈù¢</button>
                                    </div>
                                </div>
                                <div id="pdf-viewer-container" class="pdf-viewer-container">
                                    <div id="source-content" class="source-content">
                                        <p class="loading">ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©Êï∞ÊçÆÈ°πÊü•ÁúãÂéüÊñá</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÖçÁΩÆÁÆ°ÁêÜÂºπÁ™ó -->
    <div id="config-modal" class="modal">
        <div class="modal-content" style="width: 60%; max-width: 1000px;">
            <div class="modal-header">
                <h2>ÊäΩÂèñÈÖçÁΩÆÁÆ°ÁêÜ</h2>
                <div class="modal-header-controls">
                    <button class="modal-btn" onclick="zoomModalOut('config-modal')" title="Áº©Â∞è">‚àí</button>
                    <span class="modal-zoom-level">100%</span>
                    <button class="modal-btn" onclick="zoomModalIn('config-modal')" title="ÊîæÂ§ß">+</button>
                    <button class="modal-btn" onclick="resetModalZoom('config-modal')" title="ÈáçÁΩÆ">ÈáçÁΩÆ</button>
                    <button class="modal-btn" onclick="toggleModalFullscreen('config-modal')" title="ÂÖ®Â±è">‚õ∂</button>
                    <button class="modal-close" onclick="closeModal('config-modal')">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="config-tabs">
                    <button class="tab-btn active" onclick="showConfigTab('config-list')">ÈÖçÁΩÆÂàóË°®</button>
                    <button class="tab-btn" onclick="showConfigTab('config-editor')">Êñ∞Âª∫/ÁºñËæëÈÖçÁΩÆ</button>
                </div>
                
                <div id="config-list" class="config-tab-content active">
                    <div id="configs-list-container">
                        <p class="loading">Âä†ËΩΩ‰∏≠...</p>
                    </div>
                </div>
                
                <div id="config-editor" class="config-tab-content">
                    <div class="form-group">
                        <label for="config-name">ÈÖçÁΩÆÂêçÁß∞</label>
                        <input type="text" id="config-name" placeholder="ËæìÂÖ•ÈÖçÁΩÆÂêçÁß∞" required>
                    </div>
                    <div class="form-group">
                        <label for="config-description">ÈÖçÁΩÆÊèèËø∞</label>
                        <textarea id="config-description" placeholder="ËæìÂÖ•ÈÖçÁΩÆÊèèËø∞" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Êï∞ÊçÆÂ≠óÊÆµÈÖçÁΩÆ</label>
                        <div class="config-fields-container">
                            <div class="field-type-section">
                                <h4>ÂÖâÁâ©ÊÄßÊï∞ÊçÆÂ≠óÊÆµ</h4>
                                <div class="field-list" id="photophysical-fields">
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-paper_local_id" checked>
                                        <label for="pp-paper_local_id">paper_local_id</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-smiles" checked>
                                        <label for="pp-smiles">smiles</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-lambda_PL_nm" checked>
                                        <label for="pp-lambda_PL_nm">lambda_PL_nm</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-FWHM_nm" checked>
                                        <label for="pp-FWHM_nm">FWHM_nm</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-Phi_PL">
                                        <label for="pp-Phi_PL">Phi_PL</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-Delta_EST_eV">
                                        <label for="pp-Delta_EST_eV">Delta_EST_eV</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-environment_type">
                                        <label for="pp-environment_type">environment_type</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="pp-host">
                                        <label for="pp-host">host</label>
                                    </div>
                                </div>
                                <div class="custom-field-input">
                                    <input type="text" id="pp-custom-field" placeholder="Ê∑ªÂä†Ëá™ÂÆö‰πâÂ≠óÊÆµÔºàÂõûËΩ¶Ê∑ªÂä†Ôºâ">
                                </div>
                            </div>
                            <div class="field-type-section">
                                <h4>Âô®‰ª∂Êï∞ÊçÆÂ≠óÊÆµ</h4>
                                <div class="field-list" id="device-fields">
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-paper_local_id" checked>
                                        <label for="dev-paper_local_id">paper_local_id</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-EQE_max_percent" checked>
                                        <label for="dev-EQE_max_percent">EQE_max_percent</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-lambda_EL_nm">
                                        <label for="dev-lambda_EL_nm">lambda_EL_nm</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-CIE_x">
                                        <label for="dev-CIE_x">CIE_x</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-CIE_y">
                                        <label for="dev-CIE_y">CIE_y</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-emitter_name">
                                        <label for="dev-emitter_name">emitter_name</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-device_structure">
                                        <label for="dev-device_structure">device_structure</label>
                                    </div>
                                    <div class="field-item">
                                        <input type="checkbox" id="dev-host">
                                        <label for="dev-host">host</label>
                                    </div>
                                </div>
                                <div class="custom-field-input">
                                    <input type="text" id="dev-custom-field" placeholder="Ê∑ªÂä†Ëá™ÂÆö‰πâÂ≠óÊÆµÔºàÂõûËΩ¶Ê∑ªÂä†Ôºâ">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('config-modal')">ÂèñÊ∂à</button>
                        <button class="btn btn-primary" onclick="saveConfig()">‰øùÂ≠òÈÖçÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Á°ÆËÆ§ÂºπÁ™ó -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3 id="confirm-title">Á°ÆËÆ§</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message"></p>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('confirm-modal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary" id="confirm-ok">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Ê∂àÊÅØÊèêÁ§∫ -->
    <div id="toast" class="toast hidden">
        <span id="toast-message"></span>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

